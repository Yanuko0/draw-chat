(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[490],{6888:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/whiteboard/[roomId]",function(){return r(7276)}])},920:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var s=r(223),a=r(9141);let i=(0,s.Wp)({apiKey:"AIzaSyBnShUDyTKE8UjgiQYA1Os830TxKoWMKVQ",authDomain:"draw-7774d.firebaseapp.com",databaseURL:"https://draw-7774d-default-rtdb.firebaseio.com",projectId:"draw-7774d",storageBucket:"draw-7774d.firebasestorage.app",messagingSenderId:"853341293278",appId:"1:853341293278:web:4b7ee01259c97f5395904f",measurementId:"G-TD509FKTPS"}),o=(0,a.C3)(i)},7276:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(4848),a=r(6715),i=r(6540),o=r(2820);let n=(0,r(9836).v)(e=>({tool:"pencil",strokeWidth:2,strokeColor:"#000000",selectedArea:null,setTool:t=>e({tool:t}),setStrokeWidth:t=>e({strokeWidth:t}),setStrokeColor:t=>e({strokeColor:t}),setSelectedArea:t=>e({selectedArea:t})}));var l=r(920),c=r(9141),d=r(2209),h=r(3877),u=r(8221),g=r.n(u),m=r(7004),p=r(8663),x=r(9965),w=r.n(x);let b=e=>{let{onStickerSelect:t}=e,[r,a]=(0,i.useState)(!1);return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{onClick:()=>a(!r),className:"px-2 py-1 bg-gray-700 text-white rounded hover:bg-gray-600",children:(0,s.jsx)(w(),{src:"/draw-chat/stickers/sticker1.png",alt:"sticker",width:24,height:24,className:"w-6 h-6",unoptimized:!0})}),r&&(0,s.jsx)("div",{className:"absolute bottom-full mb-2 bg-white rounded-lg shadow-lg p-2 grid grid-cols-4 gap-2 max-h-[360px] overflow-y-auto z-30 w-[360px]",children:["/draw-chat/stickers/sticker1.png","/draw-chat/stickers/sticker2.png","/draw-chat/stickers/sticker3.png","/draw-chat/stickers/sticker4.png","/draw-chat/stickers/sticker5.png","/draw-chat/stickers/sticker6.png","/draw-chat/stickers/sticker7.png","/draw-chat/stickers/sticker8.png","/draw-chat/stickers/sticker9.png","/draw-chat/stickers/sticker10.png","/draw-chat/stickers/sticker11.png","/draw-chat/stickers/sticker12.png","/draw-chat/stickers/sticker13.png","/draw-chat/stickers/sticker14.png","/draw-chat/stickers/sticker15.png","/draw-chat/stickers/sticker16.png","/draw-chat/stickers/sticker17.png","/draw-chat/stickers/sticker18.png","/draw-chat/stickers/sticker19.png","/draw-chat/stickers/sticker20.png","/draw-chat/stickers/sticker21.png","/draw-chat/stickers/sticker22.png","/draw-chat/stickers/sticker23.png","/draw-chat/stickers/sticker24.png","/draw-chat/stickers/sticker25.png","/draw-chat/stickers/sticker26.png","/draw-chat/stickers/sticker27.png","/draw-chat/stickers/sticker28.png","/draw-chat/stickers/sticker29.png","/draw-chat/stickers/sticker30.png","/draw-chat/stickers/sticker31.png","/draw-chat/stickers/sticker32.png","/draw-chat/stickers/sticker33.png","/draw-chat/stickers/sticker34.png","/draw-chat/stickers/sticker35.png","/draw-chat/stickers/sticker36.png","/draw-chat/stickers/sticker37.png","/draw-chat/stickers/sticker38.png","/draw-chat/stickers/sticker39.png"].map((e,r)=>(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded flex items-center justify-center min-w-[80px] min-h-[80px]",onClick:()=>{t(e),a(!1)},children:(0,s.jsx)(w(),{src:e,alt:`sticker-${r}`,width:64,height:64,className:"w-16 h-16 object-contain",unoptimized:!0})},r))})]})},f=(0,i.memo)(e=>{let{roomId:t,nickname:r}=e,[a,u]=(0,i.useState)([]),[x,f]=(0,i.useState)(!1),[k,v]=(0,i.useState)(!1),[y,j]=(0,i.useState)(null),{tool:N,strokeWidth:C,strokeColor:E,setStrokeColor:S}=n(),[O,R]=(0,i.useState)(1),[$,z]=(0,i.useState)({x:0,y:0}),[K,D]=(0,i.useState)({width:2*window.innerWidth,height:2*window.innerHeight}),[M,W]=(0,i.useState)(!1),[P,L]=(0,i.useState)([]),[Z,B]=(0,i.useState)(null),I=(0,i.useRef)(null),[A,T]=(0,i.useState)([]),[X,_]=(0,i.useState)(""),[F,Y]=(0,i.useState)(!1),[J,U]=(0,i.useState)(160),[H,V]=(0,i.useState)([]),[q,G]=(0,i.useState)(!1),[Q,ee]=(0,i.useState)(200),[et,er]=(0,i.useState)(null),[es,ea]=(0,i.useState)([]),[ei,eo]=(0,i.useState)(!1),en=(0,i.useRef)(null),[el,ec]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}/lines`),r=(0,c.Zy)(e,e=>{let t=e.val();t?u(Object.values(t)):u([])});return()=>r()},[t]),(0,i.useEffect)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}/images`),r=(0,c.Zy)(e,e=>{let t=e.val();t?L(Object.values(t)):L([])});return()=>r()},[t]),(0,i.useEffect)(()=>{if(Z&&I.current){let e=ex.current;if(!e)return;let t=e.findOne(`#${Z}`);t&&(I.current.nodes([t]),I.current.getLayer()?.batchDraw())}},[Z,P]),(0,i.useEffect)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}/messages`),r=(0,c.Zy)(e,e=>{let t=e.val();t?T(Object.entries(t).map(e=>{let[t,r]=e;return{id:t,nickname:r.nickname,text:r.text||"",type:r.type||"text",content:r.content||"",timestamp:r.timestamp}}).sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))):T([])});return()=>r()},[t]),(0,i.useEffect)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}/users`),r=(0,c.Zy)(e,e=>{let t=e.val();t&&V(Object.keys(t))});return()=>r()},[t]),(0,i.useEffect)(()=>{if(t&&r){let e=(0,c.KR)(l.O,`rooms/${t}/users/${r}`);return(0,c.hZ)(e,{nickname:r,lastActive:(0,c.O5)()}),()=>{(0,c.hZ)(e,null)}}},[t,r]);let ed=e=>{switch(e){case"pencil":return{tension:.3,opacity:.9,strokeWidth:.8*C,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",shadowColor:E,shadowBlur:.5,shadowOffsetX:.2,shadowOffsetY:.2,bezier:!0};case"pen":return{tension:.6,opacity:1,strokeWidth:C,lineCap:"round",lineJoin:"round",shadowColor:E,shadowBlur:.2,bezier:!0};case"brush":return{tension:.4,opacity:.7,strokeWidth:2*C,lineCap:"round",lineJoin:"round",shadowColor:E,shadowBlur:2,bezier:!0};case"marker":return{tension:.2,opacity:.5,strokeWidth:2.5*C,lineCap:"round",lineJoin:"round",shadowColor:E,shadowBlur:0,bezier:!1};case"eraser":return{tension:.3,opacity:1,strokeWidth:2*C,lineCap:"round",lineJoin:"round",shadowBlur:0,bezier:!0};default:return{tension:.5,opacity:1,strokeWidth:C,lineCap:"round",lineJoin:"round"}}},eh=(0,i.useCallback)(e=>{let r=e.target.getStage().getRelativePointerPosition(),s=2===e.evt.button,a=1===e.evt.button,i="Image"===e.target.className;if(s||a||e.evt.ctrlKey||e.evt.metaKey||M){v(!0);return}if("select"===N&&i)return;f(!0);let o=ed(N),n={tool:N,points:[r.x,r.y],strokeColor:"eraser"===N?"#ffffff":E,...o};j(n);let d=(0,c.KR)(l.O,`rooms/${t}/lines`),h=(0,c.VC)(d);(0,c.hZ)(h,n)},[N,E,M,t]),eu=(0,i.useCallback)(e=>{if(k){let t=e.target.getStage();z({x:t.x()+e.evt.movementX,y:t.y()+e.evt.movementY});return}if(!x||!y)return;let r=e.target.getStage().getRelativePointerPosition(),s={...y,points:[...y.points,r.x,r.y]};j(s),ew(`rooms/${t}/lines/${a.length}`,s)},[k,x,y,t,a.length]),eg=(0,i.useCallback)(()=>{if(f(!1),v(!1),j(null),"select"===N&&et){let e=ex.current.getRelativePointerPosition();ea(a.filter(t=>t.points.some((r,s)=>{if(s%2==0){let a=t.points[s+1];return r>=Math.min(et.x,e.x)&&r<=Math.max(et.x,e.x)&&a>=Math.min(et.y,e.y)&&a<=Math.max(et.y,e.y)}return!1}))),eo(!0)}er(null)},[N,et,a]);(0,i.useEffect)(()=>{let e=()=>{D({width:2*window.innerWidth,height:2*window.innerHeight})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,i.useEffect)(()=>{let e=e=>{e.preventDefault()};return window.addEventListener("contextmenu",e),()=>window.removeEventListener("contextmenu",e)},[]);let em=(0,i.useCallback)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}/lines`);(0,c.hZ)(e,null)},[t]),ep=(0,i.useCallback)(()=>{let e=(0,c.KR)(l.O,`rooms/${t}`);(0,c.hZ)(e,null),B(null)},[t]),ex=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>e.preventDefault();return document.addEventListener("mousedown",t=>{1===t.button&&e(t)}),()=>{document.removeEventListener("mousedown",e)}},[]);let ew=(0,i.useCallback)(g()((e,t)=>{let r=(0,c.KR)(l.O,e);(0,c.hZ)(r,t)},30),[]),eb=(0,i.useMemo)(()=>{let e={};return P.forEach(t=>{if(!e[t.src]){let r=new window.Image;r.src=t.src,e[t.src]=r}}),e},[P]),ef=(0,i.useMemo)(()=>a.map((e,t)=>(0,s.jsx)(o.N1,{points:e.points,stroke:e.strokeColor,strokeWidth:e.strokeWidth/O,tension:e.tension,opacity:e.opacity,dash:e.dash,lineCap:"round",lineJoin:"round",globalCompositeOperation:"eraser"===e.tool?"destination-out":"source-over"},t)),[a,O]),ek=(0,i.useMemo)(()=>P.map((e,r)=>(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)(o._V,{id:e.id,image:eb[e.src],x:e.x,y:e.y,width:e.width,height:e.height,draggable:!0,onClick:()=>B(e.id),onDragStart:e=>{e.evt.stopPropagation()},onDragMove:e=>{e.evt.stopPropagation()},onDragEnd:r=>{r.evt.stopPropagation();let s=(0,c.KR)(l.O,`rooms/${t}/images/${e.id}`);(0,c.hZ)(s,{...e,x:r.target.x(),y:r.target.y()})}}),(Z===e.id||M)&&(0,s.jsxs)(o.YJ,{x:e.x+e.width-20,y:e.y-20,children:[(0,s.jsx)(o.jl,{radius:10,fill:"red",onClick:()=>{let r=(0,c.KR)(l.O,`rooms/${t}/images/${e.id}`);(0,c.hZ)(r,null),B(null)}}),(0,s.jsx)(o.N1,{points:[-5,-5,5,5],stroke:"white",strokeWidth:2}),(0,s.jsx)(o.N1,{points:[5,-5,-5,5],stroke:"white",strokeWidth:2})]}),Z===e.id&&(0,s.jsx)(o.Ge,{ref:I,boundBoxFunc:(e,t)=>t.width<5||t.height<5?e:t,enabledAnchors:["top-left","top-right","bottom-left","bottom-right","middle-left","middle-right","top-center","bottom-center"],rotateEnabled:!1,keepRatio:!1,padding:5,anchorSize:10,anchorCornerRadius:5,borderEnabled:!0,borderStroke:"#00ff00",borderStrokeWidth:2,anchorStroke:"#00ff00",anchorFill:"#ffffff",onTransformEnd:r=>{let s=r.target,a=s.scaleX(),i=s.scaleY();s.scaleX(1),s.scaleY(1);let o=(0,c.KR)(l.O,`rooms/${t}/images/${e.id}`);(0,c.hZ)(o,{...e,x:s.x(),y:s.y(),width:Math.max(5,s.width()*a),height:Math.max(5,s.height()*i)})}})]},r)),[P,eb,Z,t]),ev=async e=>{e.preventDefault(),console.log("Attempting to send message:",{roomId:t,nickname:r,message:X,timestamp:new Date});try{if(X.trim()&&r&&t){console.log("Creating message ref for room:",t);let e=(0,c.KR)(l.O,`rooms/${t}/messages`),s=(0,c.VC)(e);console.log("Setting message data"),await (0,c.hZ)(s,{nickname:r,text:X.trim(),timestamp:(0,c.O5)()}),console.log("Message sent successfully"),_("")}else console.log("Missing required fields:",{hasMessage:!!X.trim(),hasNickname:!!r,hasRoomId:!!t})}catch(e){console.error("Error details:",{error:e,errorMessage:e instanceof Error?e.message:"Unknown error",errorStack:e instanceof Error?e.stack:void 0})}};(0,i.useEffect)(()=>{if(ex.current){let e=ex.current.canvas;en.current=new p.Hl(e,{width:window.innerWidth,height:window.innerHeight}),en.current.on("object:modified",e=>{let r=e.target;if(r&&"image"===r.type){let e=r.get("data")?.id;if(e){let s=(0,c.KR)(l.O,`rooms/${t}/images/${e}`);(0,c.hZ)(s,{id:e,x:r.left,y:r.top,width:r.width*r.scaleX,height:r.height*r.scaleY,src:r.get("data")?.src})}}})}return()=>{en.current?.dispose()}},[]),(0,i.useEffect)(()=>{en.current&&("select"===N?(en.current.selection=!0,en.current.forEachObject(e=>{e.selectable=!0})):(en.current.selection=!1,en.current.forEachObject(e=>{e.selectable=!1})),en.current.renderAll())},[N]),(0,i.useEffect)(()=>{console.log("Canvas component props:",{roomId:t,nickname:r})},[t,r]),(0,i.useEffect)(()=>{console.log("Firebase database instance:",l.O);let e=(0,c.KR)(l.O,".info/connected");(0,c.Zy)(e,e=>{console.log("Firebase connection status:",e.val())})},[]);let ey=e=>{let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+((t<<5)-t);let r=t%360,s=50+t%20,a=80+t%10;return`hsl(${r}, ${s}%, ${a}%)`},ej=async e=>{try{if(console.log("Sending sticker:",e),r&&t){let s=(0,c.KR)(l.O,`rooms/${t}/messages`),a=(0,c.VC)(s),i={nickname:r,type:"sticker",content:e,text:"",timestamp:(0,c.O5)()};console.log("New message object:",i),await (0,c.hZ)(a,i)}}catch(e){console.error("Error sending sticker:",e)}};return(0,s.jsxs)("div",{className:"relative w-full h-screen",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),e.stopPropagation();let r=e.dataTransfer.files[0];if(r&&r.type.startsWith("image/")){let s=new FileReader;s.onload=r=>{let s=r.target?.result,a=Date.now().toString(),i=new window.Image;i.src=s,i.onload=()=>{let r={id:a,x:e.nativeEvent.offsetX||100,y:e.nativeEvent.offsetY||100,width:i.width,height:i.height,src:s};L(e=>[...e,r]);let o=(0,c.KR)(l.O,`rooms/${t}/images/${a}`);(0,c.hZ)(o,r)}},s.readAsDataURL(r)}},children:[(0,s.jsx)(o.BI,{ref:ex,width:window.innerWidth,height:window.innerHeight,onMouseDown:eh,onMousemove:eu,onMouseup:eg,onMouseleave:eg,onWheel:e=>{e.evt.preventDefault();let t=e.target.getStage(),r=t.scaleX(),s={x:t.getPointerPosition().x/r-t.x()/r,y:t.getPointerPosition().y/r-t.y()/r},a=e.evt.deltaY<0?1.1*r:r/1.1;R(a),z({x:-(s.x-t.getPointerPosition().x/a)*a,y:-(s.y-t.getPointerPosition().y/a)*a})},scaleX:O,scaleY:O,x:$.x,y:$.y,style:{background:"#ffffff"},children:(0,s.jsxs)(o.Wd,{children:[ek,ef,y&&(0,s.jsx)(o.N1,{points:y.points,stroke:y.strokeColor,strokeWidth:y.strokeWidth/O,tension:y.tension,opacity:y.opacity,dash:y.dash,lineCap:"round",lineJoin:"round",globalCompositeOperation:"eraser"===y.tool?"destination-out":"source-over"})]})}),(0,s.jsxs)("div",{className:"fixed bottom-16 right-4 bg-black bg-opacity-50 rounded-lg shadow-lg",children:[(0,s.jsx)("div",{className:"p-2 border-b border-white border-opacity-20 flex justify-end",children:(0,s.jsx)("button",{onClick:()=>ec(!el),className:"text-white hover:text-gray-300",children:el?(0,s.jsx)(m.BJp,{}):(0,s.jsx)(m.qXl,{})})}),(0,s.jsxs)("div",{className:`flex flex-col gap-2 p-2 transition-all duration-200 ${el?"w-0 overflow-hidden opacity-0":"w-auto opacity-100"}`,children:[(0,s.jsx)("button",{className:"p-2 bg-white rounded-lg shadow hover:bg-gray-100",onClick:()=>{R(1.2*O)},title:"放大",children:(0,s.jsx)(d.kh2,{size:24})}),(0,s.jsx)("button",{className:"p-2 bg-white rounded-lg shadow hover:bg-gray-100",onClick:()=>{R(O/1.2)},title:"縮小",children:(0,s.jsx)(d.T1J,{size:24})}),(0,s.jsx)("button",{className:"p-2 bg-white rounded-lg shadow hover:bg-gray-100",onClick:()=>{R(1),z({x:0,y:0})},title:"重置縮放",children:(0,s.jsx)(h.X8T,{size:24})}),(0,s.jsx)("button",{className:`p-2 rounded-lg shadow ${M?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,onClick:()=>W(!M),title:"拖曳模式",children:(0,s.jsx)(h.BwF,{size:24})}),(0,s.jsx)("label",{htmlFor:"imageUpload",className:"p-2 bg-white rounded-lg shadow hover:bg-gray-100 cursor-pointer",title:"上傳圖片",children:(0,s.jsx)(d.quV,{size:24})}),(0,s.jsx)("button",{className:"p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",onClick:em,title:"清除畫布",children:(0,s.jsx)(d.sxT,{size:24})}),(0,s.jsx)("button",{className:"p-2 bg-red-700 text-white rounded-lg hover:bg-red-800",onClick:ep,title:"清除全部",children:(0,s.jsx)(d.id1,{size:24})})]})]}),(0,s.jsxs)("div",{id:"chat-container",className:"fixed bottom-4 left-4 w-[400px] bg-black bg-opacity-50 rounded-lg shadow-lg z-40",children:[F?(0,s.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-white border-opacity-20",children:[(0,s.jsx)("h3",{className:"text-white text-sm font-medium",children:"聊天室"}),(0,s.jsx)("button",{onClick:()=>Y(!1),className:"text-white hover:text-gray-300",children:"+"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-full h-1 cursor-ns-resize hover:bg-gray-500 absolute -top-1",onMouseDown:e=>{e.preventDefault();let t=e=>{let t=document.getElementById("chat-container");if(!t)return;let r=t.getBoundingClientRect();U(Math.max(80,Math.min(window.innerHeight/2,r.bottom-e.clientY))+80)},r=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r)},style:{backgroundColor:"transparent"}}),(0,s.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-white border-opacity-20",children:[(0,s.jsx)("h3",{className:"text-white text-sm font-medium",children:"聊天室"}),(0,s.jsx)("button",{onClick:()=>Y(!0),className:"text-white hover:text-gray-300",children:"-"})]}),(0,s.jsx)("div",{className:"overflow-y-auto",style:{height:`${J-80}px`,scrollBehavior:"smooth"},ref:e=>{e&&(e.scrollTop=e.scrollHeight)},children:A.map(e=>{console.log("Rendering message:",e);let t=ey(e.nickname);return(0,s.jsx)("div",{className:"px-3 py-2 hover:bg-black hover:bg-opacity-40",children:(0,s.jsxs)("div",{className:"text-sm break-words flex items-start",children:[(0,s.jsxs)("span",{style:{color:t},className:"mr-2 flex-shrink-0",children:[e.nickname,":"]}),"sticker"===e.type?(0,s.jsx)("div",{className:"relative w-32 h-32 inline-block",children:(0,s.jsx)(w(),{src:e.content||"",alt:"sticker",fill:!0,className:"object-contain",unoptimized:!0,onError:t=>{console.error("Sticker load error:",e.content)}})}):(0,s.jsx)("span",{className:"text-white",children:e.text})]})},e.id)})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 border-t border-gray-700",children:[(0,s.jsx)(b,{onStickerSelect:ej}),(0,s.jsx)("input",{type:"text",value:X,onChange:e=>_(e.target.value),placeholder:"輸入訊息...",className:"flex-1 px-3 py-1 bg-black bg-opacity-50 text-white border border-white border-opacity-20 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,s.jsx)("button",{onClick:ev,className:"px-4 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"發送"})]})]}),(0,s.jsxs)("div",{id:"room-info-container",className:"absolute top-4 right-4 w-64 bg-black bg-opacity-50 rounded-lg shadow-lg z-40",style:{height:q?"40px":`${Q}px`,transition:"height 0.2s"},children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-white border-opacity-20",children:[(0,s.jsxs)("h3",{className:"text-white text-sm font-medium",children:["房間名: ",t]}),(0,s.jsxs)("span",{className:"text-white text-sm",children:["人數: ",H.length]}),(0,s.jsx)("button",{onClick:()=>G(!q),className:"text-white hover:text-gray-300",children:q?(0,s.jsx)(m.zAG,{}):(0,s.jsx)(m.Kj1,{})})]}),!q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"overflow-y-auto px-2",style:{height:`${Q-70}px`},children:[(0,s.jsx)("div",{className:"py-2 border-b border-white border-opacity-20",children:(0,s.jsxs)("span",{className:"text-white text-sm",children:["在線人數：",H.length]})}),(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)("p",{className:"text-white text-sm mb-1",children:"在線成員："}),(0,s.jsx)("ul",{className:"space-y-1",children:H.map((e,t)=>(0,s.jsx)("li",{className:"text-white text-sm pl-2",children:e},t))})]})]}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 w-full h-1 cursor-ns-resize hover:bg-gray-500",onMouseDown:e=>{e.preventDefault();let t=e=>{let t=document.getElementById("room-info-container");if(!t)return;let r=t.getBoundingClientRect();ee(Math.max(100,Math.min(400,e.clientY-r.top)))},r=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r)},style:{backgroundColor:"transparent"}})]})]}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let r=e.target.files?.[0];if(r){let s=new FileReader;s.onload=r=>{let s=r.target?.result;p._V.fromURL(s,{crossOrigin:"anonymous"},r=>{let a=Date.now().toString(),i={x:e.nativeEvent.offsetX||100,y:e.nativeEvent.offsetY||100};r.set({left:i.x,top:i.y,cornerColor:"blue",cornerStrokeColor:"blue",cornerSize:12,transparentCorners:!1,borderColor:"blue",borderScaleFactor:2,padding:5,data:{id:a,src:s}}),en.current?.add(r);let o=(0,c.KR)(l.O,`rooms/${t}/images/${a}`);(0,c.hZ)(o,{id:a,x:r.left,y:r.top,width:r.width,height:r.height,src:s})})},s.readAsDataURL(r)}},style:{display:"none"},id:"imageUpload"})]})}),k=()=>{let{tool:e,strokeColor:t,strokeWidth:r,setTool:a,setStrokeWidth:o,setStrokeColor:l}=n(),[c,d]=(0,i.useState)(!1),h=t=>{console.log("Toolbar: Changing tool from",e,"to",t),("eraser"===e||t!==e)&&a(t)};return(0,s.jsx)("div",{className:`fixed top-4 left-4 z-50 bg-white rounded-lg shadow-lg border border-gray-200 transition-all duration-300 ${c?"w-12":"w-auto"}`,children:c?(0,s.jsx)("div",{className:"p-2",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>d(!1),className:"p-1 hover:bg-gray-100 rounded",title:"展開工具列",children:(0,s.jsx)(m.BJp,{className:"w-4 h-4"})}),(0,s.jsx)("div",{className:"w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100",title:`當前工具: ${"eraser"===e?"橡皮擦":"pencil"===e?"鉛筆":"pen"===e?"原子筆":"brush"===e?"毛筆":"marker"===e?"麥克筆":e}`,children:"eraser"===e?"擦":"pencil"===e?"筆":"pen"===e?"筆":"brush"===e?"筆":"marker"===e?"筆":e.charAt(0)}),"eraser"!==e&&(0,s.jsx)("div",{className:"w-6 h-6 rounded-full border border-gray-300",style:{backgroundColor:t},title:"當前顏色"})]})}):(0,s.jsx)("div",{className:"p-2 md:p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("select",{className:"px-2 md:px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 border border-gray-300 text-sm",onChange:e=>h(e.target.value),value:"eraser"===e?"pencil":e,children:[(0,s.jsx)("option",{value:"pencil",children:"鉛筆"}),(0,s.jsx)("option",{value:"pen",children:"原子筆"}),(0,s.jsx)("option",{value:"brush",children:"毛筆"}),(0,s.jsx)("option",{value:"marker",children:"麥克筆"})]}),(0,s.jsx)("button",{className:`px-3 md:px-4 py-2 rounded-lg border whitespace-nowrap text-sm ${"eraser"===e?"bg-blue-500 text-white border-blue-600":"bg-gray-100 hover:bg-gray-200 border-gray-300"}`,onClick:()=>h("eraser"===e?"pencil":"eraser"),children:"橡皮擦"})]}),"eraser"!==e&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"color",value:t,onChange:e=>l(e.target.value),className:"w-8 h-8 cursor-pointer rounded border border-gray-300"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"range",min:"1",max:"50",value:r,onChange:e=>o(parseInt(e.target.value)),className:"w-32"}),(0,s.jsxs)("span",{className:"text-sm w-12",children:[r,"px"]})]})]})]}),(0,s.jsx)("button",{onClick:()=>d(!0),className:"ml-4 p-1 hover:bg-gray-100 rounded",title:"收起工具列",children:(0,s.jsx)(m.qXl,{className:"w-4 h-4"})})]})})})},v=()=>{let e=(0,a.useRouter)(),{roomId:t,nickname:r}=e.query;return((0,i.useEffect)(()=>{!r&&e.isReady&&e.push("/")},[r,e.isReady]),t&&r)?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(k,{}),(0,s.jsx)(f,{roomId:t,nickname:r})]}):(0,s.jsx)("div",{children:"Loading..."})}}},e=>{var t=t=>e(e.s=t);e.O(0,[377,505,687,758,977,951,67,636,593,792],()=>t(6888)),_N_E=e.O()}]);