(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(6887)}])},920:(e,t,s)=>{"use strict";s.d(t,{O:()=>l});var r=s(223),a=s(9141);let n=(0,r.Wp)({apiKey:"AIzaSyBnShUDyTKE8UjgiQYA1Os830TxKoWMKVQ",authDomain:"draw-7774d.firebaseapp.com",databaseURL:"https://draw-7774d-default-rtdb.firebaseio.com",projectId:"draw-7774d",storageBucket:"draw-7774d.firebasestorage.app",messagingSenderId:"853341293278",appId:"1:853341293278:web:4b7ee01259c97f5395904f",measurementId:"G-TD509FKTPS"}),l=(0,a.C3)(n)},6887:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(4848),a=s(6540),n=s(6715),l=s(920),i=s(9141),c=s(7004);let o=()=>{let[e,t]=(0,a.useState)(""),[s,o]=(0,a.useState)(""),[u,d]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(""),[g,b]=(0,a.useState)(""),[f,j]=(0,a.useState)([]),y=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=(0,i.KR)(l.O,"rooms"),t=(0,i.Zy)(e,e=>{let t=e.val();t&&Promise.all(Object.entries(t).map(async e=>{let[t,s]=e,r=s.users?Object.keys(s.users).length:0;return 0===r&&await (0,i.hZ)((0,i.KR)(l.O,`rooms/${t}`),null),{id:t,name:t,isEncrypted:s.config?.isEncrypted||!1,userCount:r}})).then(j)});return()=>t()},[]);let w=e=>/^[A-Za-z0-9]{8,16}$/.test(e),N=async t=>{if(t.preventDefault(),d(""),b(""),!e.trim()||!s.trim()){d("請輸入房間名稱和暱稱");return}if(h){if(!x){b("請設定密碼");return}if(!w(x)){b("密碼必須為8-16個英文字母或數字");return}}try{let t=(0,i.KR)(l.O,`rooms/${e}`);if((await (0,i.Jt)(t)).exists()){d("此房間名稱已存在，請選擇其他名稱或直接加入");return}h&&await (0,i.hZ)((0,i.KR)(l.O,`rooms/${e}/config`),{isEncrypted:!0,password:x}),await (0,i.hZ)((0,i.KR)(l.O,`rooms/${e}/users/${s}`),!0),y.push({pathname:`/whiteboard/${e}`,query:{nickname:s}})}catch(e){d("檢查房間時發生錯誤，請稍後再試")}},v=async t=>{if(t.preventDefault(),d(""),b(""),!e.trim()||!s.trim()){d("請輸入房間名稱和暱稱");return}try{if(!await E(e)){d("此房間不存在，請確認房間名稱或建立新房間");return}let t=(0,i.KR)(l.O,`rooms/${e}/config`),r=(await (0,i.Jt)(t)).val();if(r?.isEncrypted){if(!x){b("此房間需要密碼");return}if(x!==r.password){b("密碼錯誤");return}}y.push({pathname:`/whiteboard/${e}`,query:{nickname:s}})}catch(e){d("檢查房間時發生錯誤，請稍後再試")}},E=async e=>{let t=(0,i.KR)(l.O,`rooms/${e}`);return(await (0,i.Jt)(t)).exists()};return(0,r.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 relative",children:[(0,r.jsxs)("div",{className:"absolute top-4 right-4 w-80 bg-black bg-opacity-50 rounded-lg shadow-lg p-4",children:[(0,r.jsx)("h3",{className:"text-white text-lg font-medium mb-2",children:"已建房間"}),(0,r.jsx)("ul",{className:"space-y-2",children:f.map(e=>(0,r.jsxs)("li",{className:"flex justify-between items-center text-white text-sm",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)("span",{children:e.isEncrypted?(0,r.jsx)(c.ETn,{}):(0,r.jsx)(c.D68,{})}),(0,r.jsxs)("span",{children:[e.userCount," 人"]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg w-96",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"白板協作"}),(0,r.jsxs)("form",{className:"mb-6",children:[(0,r.jsx)("input",{type:"text",value:s,onChange:e=>o(e.target.value),placeholder:"輸入暱稱",className:"w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>{t(e.target.value),d("")},placeholder:"輸入房間名稱",className:"flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,r.jsx)("button",{type:"button",onClick:()=>m(!h),className:`p-2 rounded-lg transition-colors ${h?"bg-blue-500 text-white":"bg-gray-100 text-gray-600"}`,title:h?"取消加密":"設定加密",children:h?(0,r.jsx)(c.ETn,{size:24}):(0,r.jsx)(c.D68,{size:24})})]}),(h||u.includes("密碼"))&&(0,r.jsx)("input",{type:"password",value:x,onChange:e=>{p(e.target.value),b("")},placeholder:"輸入密碼 (8-16個英文字母或數字)",className:"w-full px-4 py-2 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"}),u&&(0,r.jsx)("div",{className:"mb-4 text-red-500 text-sm",children:u}),g&&(0,r.jsx)("div",{className:"mb-4 text-red-500 text-sm",children:g}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{type:"button",onClick:N,className:"flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors",children:"建立房間"}),(0,r.jsx)("button",{type:"button",onClick:v,className:"flex-1 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition-colors",children:"加入房間"})]})]}),(0,r.jsxs)("div",{className:"mt-4 text-sm text-gray-600",children:[(0,r.jsx)("p",{children:"提示："}),(0,r.jsxs)("ul",{className:"list-disc pl-5 mt-2",children:[(0,r.jsx)("li",{children:"房間名稱不能為空"}),(0,r.jsx)("li",{children:"可以分享網址給其他人加入"}),(0,r.jsx)("li",{children:"同一房間名稱的人可以一起協作"}),(0,r.jsx)("li",{children:"加密房間需要輸入正確密碼才能加入"})]})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[377,505,951,636,593,792],()=>t(2022)),_N_E=e.O()}]);